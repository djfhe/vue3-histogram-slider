{"version":3,"file":"vue3-histogram-slider.esm3.js","sources":["../src/lib/HistogramSlider.vue"],"sourcesContent":["<template>\n  <div class=\"vue-histogram-slider-wrapper\">\n    <svg ref=\"svgElementRef\" class=\"vue-histogram\"></svg>\n    <VueSlider\n      class=\"vue-slider\"\n      v-model=\"sliderValue\"\n      :min=\"minValue\"\n      :max=\"maxValue\"\n      :step=\"step\"\n      :dot-size=\"handleSize\"\n      :width=\"svgWidth\"\n      :height=\"16\"\n      :marks=\"marks\"\n      :lazy=\"false\"\n      :process-style=\"processStyle\"\n      :tooltip-style=\"tooltipStyle\"\n      :tooltip=\"tooltip\"\n      :tooltip-placement=\"['bottom']\"\n      :tooltip-formatter=\"prettify\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted, watch, nextTick, onBeforeUnmount } from 'vue'\nimport { min, max, bin  } from 'd3-array'\nimport type { Bin } from 'd3-array'\nimport { scaleLinear } from 'd3-scale'\nimport { select } from 'd3-selection'\nimport type { Selection } from 'd3-selection'\nimport VueSlider, { type MarkOption, type Marks, type Styles } from 'vue-3-slider-component'\n\ntype MarkStyle = Omit<MarkOption, 'label'>\n\ninterface Props {\n  data: number[]\n  min?: number\n  max?: number\n  step?: number\n  barWidth?: number\n  barGap?: number\n  barRadius?: number\n  holderColor?: string\n  colors?: string[]\n  updateColorOnChange?: boolean\n  handleSize?: number\n  grid?: boolean\n  gridNum?: number\n  prettify?: (value: number) => string\n  labelStyle?: Styles\n  markStyle?: MarkStyle\n  processStyle?: Styles\n  tooltipStyle?: Styles\n  histSliderGap?: number \n  tooltip?: 'none' | 'always' | 'focus' | 'hover' | 'active'\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  step: 1,\n  barWidth: 6,\n  barGap: 5,\n  barRadius: 4,\n  holderColor: '#dee4ec',\n  updateColorOnChange: true,\n  handleSize: 26,\n  grid: true,\n  gridNum: 4,\n  histSliderGap: 0,\n  tooltip: 'always',\n  colors: () => [],\n  prettify: (value: number) => value.toString(),\n  labelStyle: () => ({\n    color: '#0091ff',\n    fontFamily: 'Arial, sans-serif',\n    fontSize: 12,\n  }),\n  markStyle: () => ({\n    labelStyle: {\n      color: 'silver',\n      fontFamily: 'Arial, sans-serif',\n      fontSize: 12,\n    },\n    labelActiveStyle: {\n      color: '#0091ff',\n    },\n  }),\n  processStyle: () => ({\n    backgroundColor: '#0091ff',\n  }),\n  tooltipStyle: () => ({\n    backgroundColor: '#0091ff',\n    color: '#fff',\n    fontFamily: 'Arial, sans-serif',\n    fontSize: 12,\n  }),\n})\n\nconst svgElementRef = ref<SVGSVGElement | null>(null)\n\nconst modelValue = defineModel<number>({ required: true })\nconst sliderValue = computed({\n  get: () => Math.max(minValue.value, Math.min(maxValue.value, modelValue.value)),\n  set: (value: number) => (modelValue.value = value),\n})\n\nconst minValue = computed(() => props.min ?? min(props.data) ?? 0)\nconst maxValue = computed(() => props.max ?? max(props.data) ?? 100)\n\nconst svgWidth = ref(0)\nconst svgHeight = ref(0)\n\nconst marks = computed<Marks | undefined>(() => {\n  if (props.grid) {\n    const count = props.gridNum\n    const step = (maxValue.value - minValue.value) / count\n    const result: Marks = {}\n    for (let i = 0; i <= count; i++) {\n      const value = minValue.value + step * i\n      result[Math.round(value)] = {\n        ...props.markStyle,\n        label: props.prettify(value),\n      }\n    }\n    return result\n  }\n  return undefined\n})\n\nlet hist: Selection<SVGGElement, unknown, null, undefined> | null = null\n\nconst colorScale = computed<(value: number) => string>(() => {\n  if (props.colors.length > 0) {\n    return scaleLinear<string>()\n      .domain([minValue.value, maxValue.value])\n      .range(props.colors) satisfies (value: number) => string\n  }\n\n  return scaleLinear<string>()\n      .domain([minValue.value, maxValue.value])\n      .range(['#4facfe', '#00f2fe']) satisfies (value: number) => string\n})\n\nconst xScale = computed(() => {\n  const width = svgWidth.value\n  return scaleLinear()\n    .domain([minValue.value, maxValue.value])\n    .range([0, width])\n    .clamp(true)\n})\n\nconst histogramData = computed(() => {\n  const binsGenerator = bin()\n    .domain(xScale.value.domain() as [number, number])\n    .thresholds(Math.floor(svgWidth.value / (props.barWidth + props.barGap)))\n\n  return binsGenerator(props.data)\n})\n\nconst yScale = computed(() => {\n  const height = svgHeight.value\n  const maxCount = max(histogramData.value, (d) => d.length) ?? 0\n  return scaleLinear()\n    .range([height, 0])\n    .domain([0, maxCount])\n})\n\nfunction renderHistogram() {\n  if (!svgElementRef.value) return\n\n  // Update svgWidth and svgHeight\n  svgWidth.value = svgElementRef.value.clientWidth\n  svgHeight.value = svgElementRef.value.clientHeight\n\n  // Remove previous content\n  const svg = select(svgElementRef.value)\n  svg.selectAll('*').remove()\n\n  hist = svg.append('g').attr('class', 'histogram')\n\n  hist\n    .selectAll('rect')\n    .data(histogramData.value)\n    .enter()\n    .append('rect')\n    .attr('x', (d) => xScale.value(d.x0!))\n    .attr('y', (d) => yScale.value(d.length))\n    .attr('width', props.barWidth)\n    .attr('height', (d) => svgHeight.value - yScale.value(d.length))\n    .attr('rx', props.barRadius)\n    .attr('fill', (d) => getBarColor(d.x0!))\n}\n\nfunction updateHistogram() {\n  if (!hist) return\n\n  hist\n    .selectAll('rect')\n    .attr('fill', (d) => getBarColor((d as Bin<number, number>).x0!))\n}\n\nwatch(modelValue, () => {\n  updateHistogram()\n})\n\nfunction getBarColor(binValue: number): string {\n  return binValue < sliderValue.value ? colorScale.value(binValue) : props.holderColor\n}\n\nonMounted(async () => {\n  await nextTick()\n  modelValue.value = minValue.value\n  renderHistogram()\n})\n\nwatch(sliderValue, () => {\n  updateHistogram()\n})\n\nwatch(\n  () => [\n    props.data,\n    props.min,\n    props.max,\n    props.barWidth,\n    props.barGap,\n    props.barRadius,\n    props.colors,\n    props.holderColor,\n    colorScale.value, // Watch processStyle backgroundColor\n  ],\n  () => {\n    renderHistogram()\n  }\n)\n\nlet resizeObserver: ResizeObserver\n\nonMounted(() => {\n  if (svgElementRef.value) {\n    svgWidth.value = svgElementRef.value.clientWidth\n    svgHeight.value = svgElementRef.value.clientHeight\n\n    resizeObserver = new ResizeObserver(() => {\n      svgWidth.value = svgElementRef.value?.clientWidth ?? 0\n      svgHeight.value = svgElementRef.value?.clientHeight ?? 0\n      renderHistogram()\n    })\n    resizeObserver.observe(svgElementRef.value)\n  }\n})\n\nonBeforeUnmount(() => {\n  if (resizeObserver && svgElementRef.value) {\n    resizeObserver.unobserve(svgElementRef.value)\n  }\n})\n\nconst histSliderGapOffset= computed(() => {\n  return `${props.histSliderGap}px`\n})\n</script>\n\n<style scoped>\n.vue-histogram-slider-wrapper {\n  display: flex;\n  flex-direction: column;\n}\n\n.vue-histogram {\n  pointer-events: none;\n}\n\n.vue-slider {\n  flex-shrink: 0;\n  margin-top: v-bind(histSliderGapOffset);\n}\n</style>\n"],"names":["props","__props","svgElementRef","ref","modelValue","_useModel","sliderValue","computed","minValue","maxValue","value","min","max","svgWidth","svgHeight","marks","count","step","result","i","hist","colorScale","scaleLinear","xScale","width","histogramData","bin","yScale","height","maxCount","d","renderHistogram","svg","select","getBarColor","updateHistogram","watch","binValue","onMounted","nextTick","resizeObserver","_a","_b","onBeforeUnmount","histSliderGapOffset"],"mappings":"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"}